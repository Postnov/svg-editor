<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SVG Recolor Tool</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="svg-recolor">
  <style>
    .svg-recolor,
    .svg-recolor * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .svg-recolor {
      --sr-primary: #2563eb;
      --sr-primary-light: #3b82f6;
      --sr-primary-lighter: #eff6ff;
      --sr-primary-hover: #1d4ed8;
      --sr-gray-50: #f8fafc;
      --sr-gray-100: #f1f5f9;
      --sr-gray-200: #e2e8f0;
      --sr-gray-300: #cbd5e1;
      --sr-gray-400: #94a3b8;
      --sr-gray-500: #64748b;
      --sr-gray-600: #475569;
      --sr-gray-700: #334155;
      --sr-gray-900: #0f172a;
      --sr-border-radius: 12px;
      --sr-border-radius-lg: 16px;
      --sr-spacing: 1.25rem;
      --sr-shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --sr-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.07), 0 2px 4px -2px rgb(0 0 0 / 0.07);
      --sr-shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.08), 0 4px 6px -4px rgb(0 0 0 / 0.08);
      --sr-shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.08), 0 8px 10px -6px rgb(0 0 0 / 0.08);
      width: 100%;
      max-width: 720px;
      padding: 2.5rem;
      background: #ffffff;
      border-radius: var(--sr-border-radius-lg);
      box-shadow: var(--sr-shadow-xl);
      margin: 40px auto;
      border: 1px solid var(--sr-gray-100);
    }

    .svg-recolor__header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .svg-recolor__icon {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--sr-primary-light) 0%, var(--sr-primary) 100%);
      border-radius: 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25);
    }

    .svg-recolor__icon svg {
      width: 28px;
      height: 28px;
      color: white;
    }

    .svg-recolor__title {
      color: var(--sr-gray-900);
      font-size: 1.625rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 0.375rem;
    }

    .svg-recolor__subtitle {
      color: var(--sr-gray-500);
      font-size: 0.9375rem;
      font-weight: 400;
    }

    .svg-recolor__upload-zone {
      border: 2px dashed var(--sr-gray-200);
      border-radius: var(--sr-border-radius);
      padding: 2.5rem 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.25s ease;
      background: var(--sr-gray-50);
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
    }

    .svg-recolor__upload-zone::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, var(--sr-primary-lighter) 0%, transparent 100%);
      opacity: 0;
      transition: opacity 0.25s ease;
    }

    .svg-recolor__upload-zone:hover,
    .svg-recolor__upload-zone--dragover {
      border-color: var(--sr-primary-light);
      background: white;
    }

    .svg-recolor__upload-zone:hover::before,
    .svg-recolor__upload-zone--dragover::before {
      opacity: 1;
    }

    .svg-recolor__upload-content {
      position: relative;
      z-index: 1;
    }

    .svg-recolor__upload-icon {
      width: 48px;
      height: 48px;
      margin: 0 auto 1rem;
      background: white;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--sr-shadow);
      transition: transform 0.25s ease;
    }

    .svg-recolor__upload-zone:hover .svg-recolor__upload-icon {
      transform: translateY(-2px);
    }

    .svg-recolor__upload-icon svg {
      width: 24px;
      height: 24px;
      color: var(--sr-primary);
    }

    .svg-recolor__upload-text {
      color: var(--sr-gray-600);
      font-size: 0.9375rem;
      line-height: 1.5;
    }

    .svg-recolor__upload-text strong {
      color: var(--sr-primary);
      font-weight: 600;
      cursor: pointer;
    }

    .svg-recolor__upload-text strong:hover {
      text-decoration: underline;
    }

    .svg-recolor__upload-hint {
      color: var(--sr-gray-400);
      font-size: 0.8125rem;
      margin-top: 0.5rem;
    }

    .svg-recolor__file-input {
      display: none;
    }

    .svg-recolor__main-row {
      display: flex;
      gap: 2rem;
      align-items: flex-start;
      margin-bottom: 2rem;
    }

    .svg-recolor__controls {
      flex: 1;
      min-width: 0;
    }

    .svg-recolor__group {
      margin-bottom: var(--sr-spacing);
    }

    .svg-recolor__group:last-child {
      margin-bottom: 0;
    }

    .svg-recolor__label {
      display: block;
      margin-bottom: 0.625rem;
      font-weight: 600;
      font-size: 0.875rem;
      color: var(--sr-gray-700);
      letter-spacing: -0.01em;
    }

    .svg-recolor__color-group {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .svg-recolor__color-picker-wrapper {
      position: relative;
      width: 52px;
      height: 52px;
      flex-shrink: 0;
    }

    .svg-recolor__color-picker {
      -webkit-appearance: none;
      width: 52px;
      height: 52px;
      padding: 0;
      border: none;
      border-radius: var(--sr-border-radius);
      cursor: pointer;
      box-shadow: var(--sr-shadow), inset 0 0 0 3px rgba(255,255,255,0.9);
      transition: box-shadow 0.2s ease, transform 0.2s ease;
    }

    .svg-recolor__color-picker:hover {
      transform: scale(1.02);
      box-shadow: var(--sr-shadow-lg), inset 0 0 0 3px rgba(255,255,255,0.9);
    }

    .svg-recolor__color-picker::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    .svg-recolor__color-picker::-webkit-color-swatch {
      border: none;
      border-radius: var(--sr-border-radius);
    }

    .svg-recolor__input {
      width: 130px;
      padding: 0.875rem 1rem;
      border: 1px solid var(--sr-gray-200);
      border-radius: var(--sr-border-radius);
      font-size: 0.9375rem;
      font-weight: 500;
      font-family: 'SF Mono', 'Fira Code', monospace;
      letter-spacing: 0.02em;
      transition: all 0.2s ease;
      background: white;
      text-transform: uppercase;
    }

    .svg-recolor__input:focus {
      outline: none;
      border-color: var(--sr-primary);
      box-shadow: 0 0 0 4px var(--sr-primary-lighter);
    }

    .svg-recolor__preview-section {
      flex-shrink: 0;
    }

    .svg-recolor__preview-label {
      text-align: center;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--sr-gray-700);
      margin-bottom: 0.625rem;
    }

    .svg-recolor__preview-container {
      width: 200px;
      height: 200px;
      background:
        linear-gradient(45deg, var(--sr-gray-100) 25%, transparent 25%),
        linear-gradient(-45deg, var(--sr-gray-100) 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, var(--sr-gray-100) 75%),
        linear-gradient(-45deg, transparent 75%, var(--sr-gray-100) 75%);
      background-size: 16px 16px;
      background-position: 0 0, 0 8px, 8px -8px, -8px 0px;
      background-color: white;
      border-radius: var(--sr-border-radius);
      display: grid;
      place-items: center;
      padding: 20px;
      border: 1px solid var(--sr-gray-200);
      box-shadow: var(--sr-shadow-sm);
    }

    .svg-recolor__preview {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .svg-recolor__preview svg {
      max-width: 100%;
      max-height: 100%;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
    }

    .svg-recolor__mode-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .svg-recolor__mode-btn {
      padding: 0.625rem 1rem;
      border: 1px solid var(--sr-gray-200);
      border-radius: var(--sr-border-radius);
      background: white;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--sr-gray-600);
      transition: all 0.2s ease;
    }

    .svg-recolor__mode-btn:hover {
      border-color: var(--sr-primary-light);
      color: var(--sr-primary);
      background: var(--sr-primary-lighter);
    }

    .svg-recolor__mode-btn--active {
      background: var(--sr-primary);
      color: white;
      border-color: var(--sr-primary);
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.25);
    }

    .svg-recolor__mode-btn--active:hover {
      background: var(--sr-primary-hover);
      color: white;
    }

    .svg-recolor__hint {
      font-size: 0.8125rem;
      color: var(--sr-gray-400);
      margin-top: 0.5rem;
      line-height: 1.4;
    }

    .svg-recolor__divider {
      height: 1px;
      background: var(--sr-gray-100);
      margin: 0 -2.5rem 1.5rem;
    }

    .svg-recolor__actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .svg-recolor__btn {
      padding: 0.875rem 1.5rem;
      border: none;
      border-radius: var(--sr-border-radius);
      font-size: 0.9375rem;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      letter-spacing: -0.01em;
    }

    .svg-recolor__btn svg {
      width: 18px;
      height: 18px;
    }

    .svg-recolor__btn--primary {
      background: linear-gradient(135deg, var(--sr-primary-light) 0%, var(--sr-primary) 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.25);
    }

    .svg-recolor__btn--primary:hover:not(:disabled) {
      background: linear-gradient(135deg, var(--sr-primary) 0%, var(--sr-primary-hover) 100%);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.35);
      transform: translateY(-1px);
    }

    .svg-recolor__btn--secondary {
      background: white;
      color: var(--sr-gray-700);
      border: 1px solid var(--sr-gray-200);
    }

    .svg-recolor__btn--secondary:hover:not(:disabled) {
      background: var(--sr-gray-50);
      border-color: var(--sr-gray-300);
    }

    .svg-recolor__btn:disabled {
      opacity: 0.45;
      cursor: not-allowed;
      transform: none !important;
    }

    .svg-recolor__filename {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8125rem;
      color: var(--sr-gray-600);
      margin-top: 1rem;
      padding: 0.5rem 0.875rem;
      background: white;
      border-radius: 20px;
      box-shadow: var(--sr-shadow-sm);
      border: 1px solid var(--sr-gray-200);
    }

    .svg-recolor__filename svg {
      width: 14px;
      height: 14px;
      color: var(--sr-primary);
    }

    .svg-recolor__empty {
      color: var(--sr-gray-400);
      font-size: 0.875rem;
      font-weight: 500;
    }

    /* Transform buttons */
    .svg-recolor__transform-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .svg-recolor__transform-btn {
      width: 44px;
      height: 44px;
      border: 1px solid var(--sr-gray-200);
      border-radius: var(--sr-border-radius);
      background: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .svg-recolor__transform-btn svg {
      width: 20px;
      height: 20px;
      color: var(--sr-gray-600);
    }

    .svg-recolor__transform-btn:hover {
      border-color: var(--sr-primary-light);
      background: var(--sr-primary-lighter);
    }

    .svg-recolor__transform-btn:hover svg {
      color: var(--sr-primary);
    }

    .svg-recolor__transform-btn--active {
      background: var(--sr-primary);
      border-color: var(--sr-primary);
    }

    .svg-recolor__transform-btn--active svg {
      color: white;
    }

    /* Stroke width slider */
    .svg-recolor__slider-group {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .svg-recolor__slider {
      flex: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 6px;
      border-radius: 3px;
      background: var(--sr-gray-200);
      outline: none;
    }

    .svg-recolor__slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--sr-primary);
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
      transition: transform 0.15s ease;
    }

    .svg-recolor__slider::-webkit-slider-thumb:hover {
      transform: scale(1.15);
    }

    .svg-recolor__slider::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--sr-primary);
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
    }

    .svg-recolor__input--small {
      width: 60px;
      padding: 0.5rem;
      text-align: center;
      font-size: 0.875rem;
    }

    /* ViewBox grid */
    .svg-recolor__viewbox-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.5rem;
    }

    .svg-recolor__viewbox-field {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .svg-recolor__viewbox-label {
      font-size: 0.6875rem;
      color: var(--sr-gray-500);
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    .svg-recolor__viewbox-input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid var(--sr-gray-200);
      border-radius: var(--sr-border-radius);
      font-size: 0.8125rem;
      text-align: center;
      background: white;
      transition: all 0.2s ease;
    }

    .svg-recolor__viewbox-input:focus {
      outline: none;
      border-color: var(--sr-primary);
      box-shadow: 0 0 0 3px var(--sr-primary-lighter);
    }

    /* Element selection */
    .svg-recolor__preview svg *:hover {
      cursor: pointer;
      filter: brightness(1.1);
    }

    .svg-recolor__preview svg .sr-selected {
      outline: 2px dashed var(--sr-primary) !important;
      outline-offset: 2px;
    }

    .svg-recolor__selected-info {
      margin-top: 1rem;
      padding: 0.875rem;
      background: var(--sr-primary-lighter);
      border-radius: var(--sr-border-radius);
      border: 1px solid rgba(37, 99, 235, 0.2);
      display: none;
    }

    .svg-recolor__selected-info.visible {
      display: block;
    }

    .svg-recolor__selected-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }

    .svg-recolor__selected-tag {
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--sr-primary);
    }

    .svg-recolor__selected-tag code {
      background: white;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-family: 'SF Mono', 'Fira Code', monospace;
    }

    .svg-recolor__selected-actions {
      display: flex;
      gap: 0.5rem;
    }

    .svg-recolor__selected-btn {
      padding: 0.5rem 0.875rem;
      border: none;
      border-radius: var(--sr-border-radius);
      font-size: 0.8125rem;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.375rem;
      transition: all 0.2s ease;
    }

    .svg-recolor__selected-btn svg {
      width: 14px;
      height: 14px;
    }

    .svg-recolor__selected-btn--delete {
      background: #fee2e2;
      color: #dc2626;
    }

    .svg-recolor__selected-btn--delete:hover {
      background: #fecaca;
    }

    .svg-recolor__selected-btn--color {
      background: white;
      color: var(--sr-gray-700);
      border: 1px solid var(--sr-gray-200);
    }

    .svg-recolor__selected-btn--color:hover {
      border-color: var(--sr-primary);
      color: var(--sr-primary);
    }

    /* Toast notification */
    .svg-recolor__toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      padding: 0.875rem 1.25rem;
      background: var(--sr-gray-900);
      color: white;
      border-radius: var(--sr-border-radius);
      font-size: 0.875rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      z-index: 1000;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .svg-recolor__toast.visible {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    .svg-recolor__toast svg {
      width: 18px;
      height: 18px;
      color: #10b981;
    }

    /* PNG size selector */
    .svg-recolor__png-size {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-top: 1rem;
      padding: 0.875rem;
      background: var(--sr-gray-50);
      border-radius: var(--sr-border-radius);
      border: 1px solid var(--sr-gray-100);
    }

    .svg-recolor__png-label {
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--sr-gray-600);
    }

    .svg-recolor__select {
      flex: 1;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--sr-gray-200);
      border-radius: var(--sr-border-radius);
      font-size: 0.8125rem;
      background: white;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .svg-recolor__select:focus {
      outline: none;
      border-color: var(--sr-primary);
      box-shadow: 0 0 0 3px var(--sr-primary-lighter);
    }

    .svg-recolor__custom-size {
      width: 80px;
      padding: 0.5rem;
      border: 1px solid var(--sr-gray-200);
      border-radius: var(--sr-border-radius);
      font-size: 0.8125rem;
      text-align: center;
      display: none;
    }

    .svg-recolor__custom-size.visible {
      display: block;
    }

    /* Color palette */
    .svg-recolor__palette {
      display: flex;
      flex-wrap: wrap;
      gap: 0.375rem;
      margin-top: 0.75rem;
    }

    .svg-recolor__palette-color {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.15s ease;
      box-shadow: var(--sr-shadow-sm);
    }

    .svg-recolor__palette-color:hover {
      transform: scale(1.1);
    }

    .svg-recolor__palette-color--active {
      border-color: var(--sr-gray-900);
    }

    .svg-recolor__palette-add {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: 2px dashed var(--sr-gray-300);
      background: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
    }

    .svg-recolor__palette-add:hover {
      border-color: var(--sr-primary);
      background: var(--sr-primary-lighter);
    }

    .svg-recolor__palette-add svg {
      width: 14px;
      height: 14px;
      color: var(--sr-gray-400);
    }

    /* Color mode toggle */
    .svg-recolor__color-mode {
      display: flex;
      gap: 0.375rem;
      margin-bottom: 0.75rem;
    }

    .svg-recolor__color-mode-btn {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid var(--sr-gray-200);
      border-radius: var(--sr-border-radius);
      background: white;
      cursor: pointer;
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--sr-gray-600);
      transition: all 0.2s ease;
    }

    .svg-recolor__color-mode-btn:hover {
      border-color: var(--sr-primary-light);
    }

    .svg-recolor__color-mode-btn--active {
      background: var(--sr-primary);
      color: white;
      border-color: var(--sr-primary);
    }

    /* Gradient controls */
    .svg-recolor__gradient-controls {
      display: none;
    }

    .svg-recolor__gradient-controls.visible {
      display: block;
    }

    .svg-recolor__gradient-type {
      display: flex;
      gap: 0.375rem;
      margin-bottom: 0.75rem;
    }

    .svg-recolor__gradient-type-btn {
      flex: 1;
      padding: 0.375rem 0.5rem;
      border: 1px solid var(--sr-gray-200);
      border-radius: var(--sr-border-radius-sm, 6px);
      background: white;
      cursor: pointer;
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--sr-gray-600);
      transition: all 0.2s ease;
    }

    .svg-recolor__gradient-type-btn--active {
      background: var(--sr-gray-100);
      color: var(--sr-gray-900);
      border-color: var(--sr-gray-300);
    }

    .svg-recolor__gradient-preview {
      height: 36px;
      border-radius: var(--sr-border-radius);
      margin-bottom: 0.75rem;
      border: 1px solid var(--sr-gray-200);
    }

    .svg-recolor__gradient-stops {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .svg-recolor__gradient-stop {
      flex: 1;
      text-align: center;
    }

    .svg-recolor__gradient-stop-label {
      font-size: 0.6875rem;
      color: var(--sr-gray-500);
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .svg-recolor__gradient-stop input[type="color"] {
      width: 100%;
      height: 36px;
      border: none;
      border-radius: var(--sr-border-radius);
      cursor: pointer;
      box-shadow: var(--sr-shadow-sm);
    }

    .svg-recolor__gradient-stop input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    .svg-recolor__gradient-stop input[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: var(--sr-border-radius);
    }

    .svg-recolor__gradient-angle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .svg-recolor__gradient-angle-label {
      font-size: 0.75rem;
      color: var(--sr-gray-600);
      font-weight: 500;
    }

    @media (max-width: 600px) {
      .svg-recolor {
        margin: 20px;
        padding: 1.5rem;
      }
      .svg-recolor__main-row {
        flex-direction: column;
        gap: 1.5rem;
      }
      .svg-recolor__preview-container {
        width: 100%;
        max-width: 200px;
        height: 180px;
        margin: 0 auto;
      }
      .svg-recolor__actions {
        flex-direction: column;
      }
      .svg-recolor__btn {
        width: 100%;
        justify-content: center;
      }
      .svg-recolor__divider {
        margin-left: -1.5rem;
        margin-right: -1.5rem;
      }
    }
  </style>

  <div class="svg-recolor__header">
    <div class="svg-recolor__icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
      </svg>
    </div>
    <h2 class="svg-recolor__title">SVG Recolor Tool</h2>
    <p class="svg-recolor__subtitle">Быстро измените цвет вашей SVG-иконки</p>
  </div>

  <div class="svg-recolor__upload-zone" id="sr-dropzone">
    <div class="svg-recolor__upload-content">
      <div class="svg-recolor__upload-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="17 8 12 3 7 8"/>
          <line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
      </div>
      <div class="svg-recolor__upload-text">
        Перетащите SVG сюда или <strong>выберите файл</strong>
      </div>
      <div class="svg-recolor__upload-hint">Поддерживаются файлы .svg</div>
    </div>
    <input type="file" id="sr-file-input" class="svg-recolor__file-input" accept=".svg,image/svg+xml">
    <div id="sr-filename" class="svg-recolor__filename" style="display: none;"></div>
  </div>

  <div class="svg-recolor__main-row">
    <div class="svg-recolor__controls">
      <div class="svg-recolor__group">
        <label class="svg-recolor__label">Режим перекраски</label>
        <div class="svg-recolor__mode-group">
          <button class="svg-recolor__mode-btn svg-recolor__mode-btn--active" data-mode="fill">Fill</button>
          <button class="svg-recolor__mode-btn" data-mode="stroke">Stroke</button>
          <button class="svg-recolor__mode-btn" data-mode="both">Оба</button>
          <button class="svg-recolor__mode-btn" data-mode="all">Всё в один</button>
        </div>
        <div class="svg-recolor__hint">Fill — заливка, Stroke — обводка, Всё в один — полностью однотонный</div>
      </div>

      <div class="svg-recolor__group">
        <label class="svg-recolor__label">Тип заливки</label>
        <div class="svg-recolor__color-mode">
          <button class="svg-recolor__color-mode-btn svg-recolor__color-mode-btn--active" data-mode="solid">Сплошной</button>
          <button class="svg-recolor__color-mode-btn" data-mode="gradient">Градиент</button>
        </div>

        <!-- Solid color controls -->
        <div id="sr-solid-controls">
          <div class="svg-recolor__color-group">
            <div class="svg-recolor__color-picker-wrapper">
              <input type="color" id="sr-color" class="svg-recolor__color-picker" value="#2563eb">
            </div>
            <input type="text" id="sr-color-text" class="svg-recolor__input" value="#2563EB">
          </div>
          <div class="svg-recolor__palette" id="sr-palette">
          <div class="svg-recolor__palette-color svg-recolor__palette-color--active" style="background: #2563eb" data-color="#2563eb"></div>
          <div class="svg-recolor__palette-color" style="background: #7c3aed" data-color="#7c3aed"></div>
          <div class="svg-recolor__palette-color" style="background: #db2777" data-color="#db2777"></div>
          <div class="svg-recolor__palette-color" style="background: #dc2626" data-color="#dc2626"></div>
          <div class="svg-recolor__palette-color" style="background: #ea580c" data-color="#ea580c"></div>
          <div class="svg-recolor__palette-color" style="background: #16a34a" data-color="#16a34a"></div>
          <div class="svg-recolor__palette-color" style="background: #0891b2" data-color="#0891b2"></div>
          <div class="svg-recolor__palette-color" style="background: #1e293b" data-color="#1e293b"></div>
          <button class="svg-recolor__palette-add" id="sr-add-color" title="Добавить цвет">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          </button>
        </div>
        </div>

        <!-- Gradient controls -->
        <div id="sr-gradient-controls" class="svg-recolor__gradient-controls">
          <div class="svg-recolor__gradient-type">
            <button class="svg-recolor__gradient-type-btn svg-recolor__gradient-type-btn--active" data-type="linear">Линейный</button>
            <button class="svg-recolor__gradient-type-btn" data-type="radial">Радиальный</button>
          </div>
          <div class="svg-recolor__gradient-preview" id="sr-gradient-preview"></div>
          <div class="svg-recolor__gradient-stops">
            <div class="svg-recolor__gradient-stop">
              <div class="svg-recolor__gradient-stop-label">Начало</div>
              <input type="color" id="sr-grad-start" value="#2563eb">
            </div>
            <div class="svg-recolor__gradient-stop">
              <div class="svg-recolor__gradient-stop-label">Конец</div>
              <input type="color" id="sr-grad-end" value="#7c3aed">
            </div>
          </div>
          <div class="svg-recolor__gradient-angle" id="sr-angle-controls">
            <span class="svg-recolor__gradient-angle-label">Угол:</span>
            <input type="range" id="sr-grad-angle" class="svg-recolor__slider" min="0" max="360" value="135" style="flex: 1;">
            <input type="number" id="sr-grad-angle-value" class="svg-recolor__input svg-recolor__input--small" min="0" max="360" value="135">
          </div>
        </div>
      </div>

      <div class="svg-recolor__group">
        <label class="svg-recolor__label">Толщина обводки</label>
        <div class="svg-recolor__slider-group">
          <input type="range" id="sr-stroke-width" class="svg-recolor__slider" min="0" max="10" step="0.5" value="2">
          <input type="number" id="sr-stroke-value" class="svg-recolor__input svg-recolor__input--small" min="0" max="20" step="0.5" value="2">
        </div>
      </div>

      <div class="svg-recolor__group">
        <label class="svg-recolor__label">Трансформация</label>
        <div class="svg-recolor__transform-group">
          <button class="svg-recolor__transform-btn" id="sr-rotate-left" title="Повернуть влево на 90°">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="1 4 1 10 7 10"/>
              <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
            </svg>
          </button>
          <button class="svg-recolor__transform-btn" id="sr-rotate-right" title="Повернуть вправо на 90°">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="23 4 23 10 17 10"/>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
          </button>
          <button class="svg-recolor__transform-btn" id="sr-flip-h" title="Отразить по горизонтали">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M8 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3"/>
              <path d="M16 3h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-3"/>
              <line x1="12" y1="3" x2="12" y2="21"/>
            </svg>
          </button>
          <button class="svg-recolor__transform-btn" id="sr-flip-v" title="Отразить по вертикали">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 8V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v3"/>
              <path d="M3 16v3a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-3"/>
              <line x1="3" y1="12" x2="21" y2="12"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="svg-recolor__group">
        <label class="svg-recolor__label">ViewBox (обрезка)</label>
        <div class="svg-recolor__viewbox-grid">
          <div class="svg-recolor__viewbox-field">
            <span class="svg-recolor__viewbox-label">X</span>
            <input type="number" id="sr-vb-x" class="svg-recolor__viewbox-input" value="0">
          </div>
          <div class="svg-recolor__viewbox-field">
            <span class="svg-recolor__viewbox-label">Y</span>
            <input type="number" id="sr-vb-y" class="svg-recolor__viewbox-input" value="0">
          </div>
          <div class="svg-recolor__viewbox-field">
            <span class="svg-recolor__viewbox-label">W</span>
            <input type="number" id="sr-vb-w" class="svg-recolor__viewbox-input" value="24" min="1">
          </div>
          <div class="svg-recolor__viewbox-field">
            <span class="svg-recolor__viewbox-label">H</span>
            <input type="number" id="sr-vb-h" class="svg-recolor__viewbox-input" value="24" min="1">
          </div>
        </div>
      </div>
    </div>

    <div class="svg-recolor__preview-section">
      <div class="svg-recolor__preview-label">Превью</div>
      <div class="svg-recolor__preview-container">
        <div id="sr-preview" class="svg-recolor__preview">
          <span class="svg-recolor__empty">SVG не загружен</span>
        </div>
      </div>

      <!-- Selected element info -->
      <div class="svg-recolor__selected-info" id="sr-selected-info">
        <div class="svg-recolor__selected-header">
          <span class="svg-recolor__selected-tag">Выбран: <code id="sr-selected-tag"></code></span>
        </div>
        <div class="svg-recolor__selected-actions">
          <button class="svg-recolor__selected-btn svg-recolor__selected-btn--color" id="sr-color-element">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
            Перекрасить
          </button>
          <button class="svg-recolor__selected-btn svg-recolor__selected-btn--delete" id="sr-delete-element">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
            Удалить
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="svg-recolor__toast" id="sr-toast">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
    <span id="sr-toast-text">Элемент удалён</span>
  </div>

  <div class="svg-recolor__divider"></div>

  <div class="svg-recolor__actions">
    <button id="sr-download-svg" class="svg-recolor__btn svg-recolor__btn--primary" disabled>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="7 10 12 15 17 10"/>
        <line x1="12" y1="15" x2="12" y2="3"/>
      </svg>
      Скачать SVG
    </button>
    <button id="sr-download-png" class="svg-recolor__btn svg-recolor__btn--secondary" disabled>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        <circle cx="8.5" cy="8.5" r="1.5"/>
        <polyline points="21 15 16 10 5 21"/>
      </svg>
      Скачать PNG
    </button>
    <button id="sr-copy-svg" class="svg-recolor__btn svg-recolor__btn--secondary" disabled>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
      </svg>
      Копировать
    </button>
    <button id="sr-reset" class="svg-recolor__btn svg-recolor__btn--secondary" disabled>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="1 4 1 10 7 10"/>
        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
      </svg>
      Сбросить
    </button>
  </div>

  <!-- PNG Size Selector -->
  <div class="svg-recolor__png-size">
    <span class="svg-recolor__png-label">Размер PNG:</span>
    <select id="sr-png-size" class="svg-recolor__select">
      <option value="64">64 × 64</option>
      <option value="128">128 × 128</option>
      <option value="256">256 × 256</option>
      <option value="512" selected>512 × 512</option>
      <option value="1024">1024 × 1024</option>
      <option value="2048">2048 × 2048</option>
      <option value="custom">Свой размер...</option>
    </select>
    <input type="number" id="sr-png-custom" class="svg-recolor__custom-size" placeholder="px" min="16" max="4096">
  </div>
</div>

<script>
(function() {
  const elements = {
    dropzone: document.getElementById('sr-dropzone'),
    fileInput: document.getElementById('sr-file-input'),
    filename: document.getElementById('sr-filename'),
    colorPicker: document.getElementById('sr-color'),
    colorText: document.getElementById('sr-color-text'),
    preview: document.getElementById('sr-preview'),
    downloadSvg: document.getElementById('sr-download-svg'),
    downloadPng: document.getElementById('sr-download-png'),
    copySvg: document.getElementById('sr-copy-svg'),
    resetBtn: document.getElementById('sr-reset'),
    modeBtns: document.querySelectorAll('.svg-recolor__mode-btn')
  };

  let originalSvg = null;
  let currentSvg = null;
  let currentFilename = 'icon';
  let currentMode = 'fill';
  let rotation = 0;
  let flipH = false;
  let flipV = false;
  let strokeWidth = 2;
  let viewBox = { x: 0, y: 0, w: 24, h: 24 };
  let selectedElement = null;
  let colorMode = 'solid'; // solid or gradient
  let gradientType = 'linear'; // linear or radial
  let gradientAngle = 135;

  // Drag & drop
  ['dragenter', 'dragover'].forEach(evt => {
    elements.dropzone.addEventListener(evt, e => {
      e.preventDefault();
      elements.dropzone.classList.add('svg-recolor__upload-zone--dragover');
    });
  });

  ['dragleave', 'drop'].forEach(evt => {
    elements.dropzone.addEventListener(evt, e => {
      e.preventDefault();
      elements.dropzone.classList.remove('svg-recolor__upload-zone--dragover');
    });
  });

  elements.dropzone.addEventListener('drop', e => {
    const file = e.dataTransfer.files[0];
    if (file && file.type === 'image/svg+xml') {
      loadFile(file);
    }
  });

  elements.dropzone.addEventListener('click', () => elements.fileInput.click());
  elements.fileInput.addEventListener('change', e => {
    if (e.target.files[0]) loadFile(e.target.files[0]);
  });

  function loadFile(file) {
    currentFilename = file.name.replace('.svg', '');
    elements.filename.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>${file.name}`;
    elements.filename.style.display = 'inline-flex';

    const reader = new FileReader();
    reader.onload = e => {
      originalSvg = e.target.result;
      currentSvg = originalSvg;
      initViewBox();
      applyColor();
      enableButtons(true);
    };
    reader.readAsText(file);
  }

  function initViewBox() {
    const parser = new DOMParser();
    const doc = parser.parseFromString(originalSvg, 'image/svg+xml');
    const svg = doc.querySelector('svg');

    if (svg) {
      let vb = svg.getAttribute('viewBox');
      if (vb) {
        const parts = vb.split(/\s+/).map(Number);
        viewBox = { x: parts[0] || 0, y: parts[1] || 0, w: parts[2] || 24, h: parts[3] || 24 };
      } else {
        const w = parseFloat(svg.getAttribute('width')) || 24;
        const h = parseFloat(svg.getAttribute('height')) || 24;
        viewBox = { x: 0, y: 0, w, h };
      }
      updateViewBoxInputs();
    }
  }

  function updateViewBoxInputs() {
    document.getElementById('sr-vb-x').value = viewBox.x;
    document.getElementById('sr-vb-y').value = viewBox.y;
    document.getElementById('sr-vb-w').value = viewBox.w;
    document.getElementById('sr-vb-h').value = viewBox.h;
  }

  function enableButtons(enabled) {
    elements.downloadSvg.disabled = !enabled;
    elements.downloadPng.disabled = !enabled;
    elements.copySvg.disabled = !enabled;
    elements.resetBtn.disabled = !enabled;
  }

  // Mode buttons
  elements.modeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      elements.modeBtns.forEach(b => b.classList.remove('svg-recolor__mode-btn--active'));
      btn.classList.add('svg-recolor__mode-btn--active');
      currentMode = btn.dataset.mode;
      if (originalSvg) applyColor();
    });
  });

  // Color sync
  elements.colorPicker.addEventListener('input', () => {
    elements.colorText.value = elements.colorPicker.value;
    if (originalSvg) applyColor();
  });

  elements.colorText.addEventListener('input', () => {
    const val = elements.colorText.value;
    if (/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(val)) {
      elements.colorPicker.value = val;
      if (originalSvg) applyColor();
    }
  });

  // Color palette
  const palette = document.getElementById('sr-palette');

  palette.addEventListener('click', (e) => {
    const colorEl = e.target.closest('.svg-recolor__palette-color');
    if (colorEl && colorEl.dataset.color) {
      // Update active state
      palette.querySelectorAll('.svg-recolor__palette-color').forEach(c => {
        c.classList.remove('svg-recolor__palette-color--active');
      });
      colorEl.classList.add('svg-recolor__palette-color--active');

      // Apply color
      const color = colorEl.dataset.color;
      elements.colorPicker.value = color;
      elements.colorText.value = color.toUpperCase();
      if (originalSvg) applyColor();
    }
  });

  // Add color to palette
  document.getElementById('sr-add-color').addEventListener('click', () => {
    const color = elements.colorPicker.value;

    // Check if color already exists
    const existing = palette.querySelector(`[data-color="${color}"]`);
    if (existing) {
      showToast('Цвет уже в палитре');
      return;
    }

    const newColor = document.createElement('div');
    newColor.className = 'svg-recolor__palette-color';
    newColor.style.background = color;
    newColor.dataset.color = color;

    const addBtn = document.getElementById('sr-add-color');
    palette.insertBefore(newColor, addBtn);

    showToast('Цвет добавлен в палитру');
  });

  // Color mode toggle (solid/gradient)
  document.querySelectorAll('.svg-recolor__color-mode-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.svg-recolor__color-mode-btn').forEach(b => {
        b.classList.remove('svg-recolor__color-mode-btn--active');
      });
      btn.classList.add('svg-recolor__color-mode-btn--active');
      colorMode = btn.dataset.mode;

      document.getElementById('sr-solid-controls').style.display = colorMode === 'solid' ? 'block' : 'none';
      document.getElementById('sr-gradient-controls').classList.toggle('visible', colorMode === 'gradient');

      if (colorMode === 'gradient') {
        updateGradientPreview();
      }
      if (originalSvg) applyColor();
    });
  });

  // Gradient type toggle
  document.querySelectorAll('.svg-recolor__gradient-type-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.svg-recolor__gradient-type-btn').forEach(b => {
        b.classList.remove('svg-recolor__gradient-type-btn--active');
      });
      btn.classList.add('svg-recolor__gradient-type-btn--active');
      gradientType = btn.dataset.type;

      // Show/hide angle controls for linear gradient
      document.getElementById('sr-angle-controls').style.display = gradientType === 'linear' ? 'flex' : 'none';

      updateGradientPreview();
      if (originalSvg) applyColor();
    });
  });

  // Gradient color inputs
  const gradStart = document.getElementById('sr-grad-start');
  const gradEnd = document.getElementById('sr-grad-end');
  const gradAngleSlider = document.getElementById('sr-grad-angle');
  const gradAngleInput = document.getElementById('sr-grad-angle-value');

  [gradStart, gradEnd].forEach(input => {
    input.addEventListener('input', () => {
      updateGradientPreview();
      if (originalSvg) applyColor();
    });
  });

  gradAngleSlider.addEventListener('input', () => {
    gradientAngle = parseInt(gradAngleSlider.value);
    gradAngleInput.value = gradientAngle;
    updateGradientPreview();
    if (originalSvg) applyColor();
  });

  gradAngleInput.addEventListener('input', () => {
    gradientAngle = parseInt(gradAngleInput.value) || 0;
    gradAngleSlider.value = gradientAngle;
    updateGradientPreview();
    if (originalSvg) applyColor();
  });

  function updateGradientPreview() {
    const preview = document.getElementById('sr-gradient-preview');
    const start = gradStart.value;
    const end = gradEnd.value;

    if (gradientType === 'linear') {
      preview.style.background = `linear-gradient(${gradientAngle}deg, ${start}, ${end})`;
    } else {
      preview.style.background = `radial-gradient(circle, ${start}, ${end})`;
    }
  }

  // Initialize gradient preview
  updateGradientPreview();

  function applyColor() {
    const solidColor = elements.colorPicker.value;
    const parser = new DOMParser();
    const doc = parser.parseFromString(originalSvg, 'image/svg+xml');
    const svg = doc.querySelector('svg');

    if (!svg) {
      elements.preview.innerHTML = '<span class="svg-recolor__empty">Ошибка парсинга SVG</span>';
      return;
    }

    // Apply custom viewBox
    svg.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.w} ${viewBox.h}`);
    svg.removeAttribute('width');
    svg.removeAttribute('height');

    // Determine color value (solid or gradient reference)
    let color = solidColor;

    if (colorMode === 'gradient') {
      // Remove old gradient defs
      const oldDefs = svg.querySelector('defs#sr-gradient-defs');
      if (oldDefs) oldDefs.remove();

      // Create gradient definition
      const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
      defs.id = 'sr-gradient-defs';

      const gradId = 'sr-grad';
      let grad;

      if (gradientType === 'linear') {
        grad = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
        const angle = gradientAngle;
        const rad = (angle - 90) * Math.PI / 180;
        const x1 = 50 + 50 * Math.cos(rad + Math.PI);
        const y1 = 50 + 50 * Math.sin(rad + Math.PI);
        const x2 = 50 + 50 * Math.cos(rad);
        const y2 = 50 + 50 * Math.sin(rad);
        grad.setAttribute('x1', x1 + '%');
        grad.setAttribute('y1', y1 + '%');
        grad.setAttribute('x2', x2 + '%');
        grad.setAttribute('y2', y2 + '%');
      } else {
        grad = document.createElementNS('http://www.w3.org/2000/svg', 'radialGradient');
        grad.setAttribute('cx', '50%');
        grad.setAttribute('cy', '50%');
        grad.setAttribute('r', '50%');
      }

      grad.id = gradId;

      const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
      stop1.setAttribute('offset', '0%');
      stop1.setAttribute('stop-color', document.getElementById('sr-grad-start').value);

      const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
      stop2.setAttribute('offset', '100%');
      stop2.setAttribute('stop-color', document.getElementById('sr-grad-end').value);

      grad.appendChild(stop1);
      grad.appendChild(stop2);
      defs.appendChild(grad);
      svg.insertBefore(defs, svg.firstChild);

      color = `url(#${gradId})`;
    }

    const allElements = svg.querySelectorAll('*');
    
    allElements.forEach(el => {
      const tagName = el.tagName.toLowerCase();
      
      // Skip non-visual elements
      if (['defs', 'title', 'desc', 'metadata', 'style', 'clipPath', 'mask', 'pattern', 'linearGradient', 'radialGradient', 'stop'].includes(tagName)) {
        return;
      }

      switch(currentMode) {
        case 'fill':
          // Change fill only if it exists and isn't 'none'
          if (el.getAttribute('fill') !== 'none') {
            el.setAttribute('fill', color);
          }
          // Also handle style attribute
          if (el.style.fill && el.style.fill !== 'none') {
            el.style.fill = color;
          }
          break;
          
        case 'stroke':
          // Change stroke only if it exists and isn't 'none'
          if (el.getAttribute('stroke') && el.getAttribute('stroke') !== 'none') {
            el.setAttribute('stroke', color);
          }
          if (el.style.stroke && el.style.stroke !== 'none') {
            el.style.stroke = color;
          }
          break;
          
        case 'both':
          if (el.getAttribute('fill') !== 'none') {
            el.setAttribute('fill', color);
          }
          if (el.getAttribute('stroke') && el.getAttribute('stroke') !== 'none') {
            el.setAttribute('stroke', color);
          }
          if (el.style.fill && el.style.fill !== 'none') {
            el.style.fill = color;
          }
          if (el.style.stroke && el.style.stroke !== 'none') {
            el.style.stroke = color;
          }
          break;
          
        case 'all':
          // Force everything to one color
          el.setAttribute('fill', color);
          el.removeAttribute('stroke');
          el.style.fill = color;
          el.style.stroke = '';
          break;
      }
    });

    // Handle SVG root fill if needed
    if (currentMode === 'fill' || currentMode === 'both' || currentMode === 'all') {
      if (svg.getAttribute('fill') !== 'none') {
        svg.setAttribute('fill', color);
      }
    }

    // Apply stroke width
    applyStrokeWidth(svg);

    // Apply transforms
    applyTransforms(svg);

    currentSvg = new XMLSerializer().serializeToString(svg);
    elements.preview.innerHTML = currentSvg;

    // Setup element selection after rendering
    setupElementSelection();
  }

  function applyStrokeWidth(svg) {
    const allElements = svg.querySelectorAll('*');

    allElements.forEach(el => {
      // Only apply to elements that have stroke
      if (el.getAttribute('stroke') && el.getAttribute('stroke') !== 'none') {
        el.setAttribute('stroke-width', strokeWidth);
      }
      if (el.style.stroke && el.style.stroke !== 'none') {
        el.style.strokeWidth = strokeWidth;
      }
    });
  }

  function applyTransforms(svg) {
    if (rotation === 0 && !flipH && !flipV) return;

    // Get viewBox for center calculation
    let vb = svg.getAttribute('viewBox');
    if (!vb) return;

    const parts = vb.split(/\s+/).map(Number);
    const cx = parts[0] + parts[2] / 2;
    const cy = parts[1] + parts[3] / 2;

    const transforms = [];

    // Apply rotation
    if (rotation !== 0) {
      transforms.push(`rotate(${rotation} ${cx} ${cy})`);
    }

    // Apply flip
    if (flipH || flipV) {
      const scaleX = flipH ? -1 : 1;
      const scaleY = flipV ? -1 : 1;
      transforms.push(`translate(${flipH ? parts[2] + 2 * parts[0] : 0} ${flipV ? parts[3] + 2 * parts[1] : 0})`);
      transforms.push(`scale(${scaleX} ${scaleY})`);
    }

    if (transforms.length > 0) {
      // Create wrapper group for transforms
      const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
      g.setAttribute('transform', transforms.join(' '));

      // Move all children to the group
      while (svg.firstChild) {
        g.appendChild(svg.firstChild);
      }
      svg.appendChild(g);
    }
  }

  // Download SVG
  elements.downloadSvg.addEventListener('click', () => {
    const blob = new Blob([currentSvg], { type: 'image/svg+xml' });
    downloadBlob(blob, `${currentFilename}-recolored.svg`);
  });

  // Copy SVG to clipboard
  elements.copySvg.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(currentSvg);
      showToast('SVG скопирован в буфер');
    } catch (err) {
      // Fallback for older browsers
      const textarea = document.createElement('textarea');
      textarea.value = currentSvg;
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      showToast('SVG скопирован в буфер');
    }
  });

  // PNG Size selector
  const pngSizeSelect = document.getElementById('sr-png-size');
  const pngCustomInput = document.getElementById('sr-png-custom');

  pngSizeSelect.addEventListener('change', () => {
    pngCustomInput.classList.toggle('visible', pngSizeSelect.value === 'custom');
    if (pngSizeSelect.value === 'custom') {
      pngCustomInput.focus();
    }
  });

  function getPngSize() {
    if (pngSizeSelect.value === 'custom') {
      return parseInt(pngCustomInput.value) || 512;
    }
    return parseInt(pngSizeSelect.value);
  }

  // Download PNG
  elements.downloadPng.addEventListener('click', () => {
    const parser = new DOMParser();
    const doc = parser.parseFromString(currentSvg, 'image/svg+xml');
    const svg = doc.querySelector('svg');

    // Get size from selector
    const size = getPngSize();
    svg.setAttribute('width', size);
    svg.setAttribute('height', size);

    const svgData = new XMLSerializer().serializeToString(svg);
    const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
    const url = URL.createObjectURL(svgBlob);

    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement('canvas');
      canvas.width = size;
      canvas.height = size;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, size, size);

      canvas.toBlob(blob => {
        downloadBlob(blob, `${currentFilename}-recolored.png`);
        URL.revokeObjectURL(url);
      }, 'image/png');
    };
    img.src = url;
  });

  // Reset
  elements.resetBtn.addEventListener('click', () => {
    currentSvg = originalSvg;
    rotation = 0;
    flipH = false;
    flipV = false;
    strokeWidth = 2;
    document.getElementById('sr-flip-h').classList.remove('svg-recolor__transform-btn--active');
    document.getElementById('sr-flip-v').classList.remove('svg-recolor__transform-btn--active');
    document.getElementById('sr-stroke-width').value = 2;
    document.getElementById('sr-stroke-value').value = 2;
    initViewBox(); // Restore original viewBox
    applyColor();
  });

  // Transform buttons
  document.getElementById('sr-rotate-left').addEventListener('click', () => {
    rotation = (rotation - 90 + 360) % 360;
    if (originalSvg) applyColor();
  });

  document.getElementById('sr-rotate-right').addEventListener('click', () => {
    rotation = (rotation + 90) % 360;
    if (originalSvg) applyColor();
  });

  document.getElementById('sr-flip-h').addEventListener('click', function() {
    flipH = !flipH;
    this.classList.toggle('svg-recolor__transform-btn--active', flipH);
    if (originalSvg) applyColor();
  });

  document.getElementById('sr-flip-v').addEventListener('click', function() {
    flipV = !flipV;
    this.classList.toggle('svg-recolor__transform-btn--active', flipV);
    if (originalSvg) applyColor();
  });

  // Stroke width controls
  const strokeSlider = document.getElementById('sr-stroke-width');
  const strokeInput = document.getElementById('sr-stroke-value');

  strokeSlider.addEventListener('input', () => {
    strokeWidth = parseFloat(strokeSlider.value);
    strokeInput.value = strokeWidth;
    if (originalSvg) applyColor();
  });

  strokeInput.addEventListener('input', () => {
    strokeWidth = parseFloat(strokeInput.value) || 0;
    strokeSlider.value = Math.min(strokeWidth, 10);
    if (originalSvg) applyColor();
  });

  // ViewBox controls
  ['sr-vb-x', 'sr-vb-y', 'sr-vb-w', 'sr-vb-h'].forEach(id => {
    document.getElementById(id).addEventListener('input', function() {
      const key = id.split('-')[2]; // x, y, w, h
      viewBox[key] = parseFloat(this.value) || 0;
      if (viewBox.w < 1) viewBox.w = 1;
      if (viewBox.h < 1) viewBox.h = 1;
      if (originalSvg) applyColor();
    });
  });

  // Element selection
  function setupElementSelection() {
    const svgEl = elements.preview.querySelector('svg');
    if (!svgEl) return;

    const selectableEls = svgEl.querySelectorAll('path, rect, circle, ellipse, polygon, polyline, line, text, g');

    selectableEls.forEach(el => {
      el.addEventListener('click', (e) => {
        e.stopPropagation();

        // Remove previous selection
        svgEl.querySelectorAll('.sr-selected').forEach(s => s.classList.remove('sr-selected'));

        // Select this element
        el.classList.add('sr-selected');
        selectedElement = el;

        document.getElementById('sr-selected-tag').textContent = `<${el.tagName.toLowerCase()}>`;
        document.getElementById('sr-selected-info').classList.add('visible');
      });
    });

    // Click outside to deselect
    elements.preview.addEventListener('click', (e) => {
      if (e.target === elements.preview || e.target === svgEl) {
        deselectElement();
      }
    });
  }

  function deselectElement() {
    const svgEl = elements.preview.querySelector('svg');
    if (svgEl) {
      svgEl.querySelectorAll('.sr-selected').forEach(s => s.classList.remove('sr-selected'));
    }
    selectedElement = null;
    document.getElementById('sr-selected-info').classList.remove('visible');
  }

  // Delete selected element
  document.getElementById('sr-delete-element').addEventListener('click', () => {
    if (!selectedElement) return;

    selectedElement.remove();
    selectedElement = null;
    document.getElementById('sr-selected-info').classList.remove('visible');

    // Update currentSvg
    const svgEl = elements.preview.querySelector('svg');
    if (svgEl) {
      currentSvg = new XMLSerializer().serializeToString(svgEl);
    }

    showToast('Элемент удалён');
  });

  // Color selected element
  document.getElementById('sr-color-element').addEventListener('click', () => {
    if (!selectedElement) return;

    const color = elements.colorPicker.value;
    selectedElement.setAttribute('fill', color);
    if (selectedElement.getAttribute('stroke') && selectedElement.getAttribute('stroke') !== 'none') {
      selectedElement.setAttribute('stroke', color);
    }

    // Update currentSvg
    const svgEl = elements.preview.querySelector('svg');
    if (svgEl) {
      currentSvg = new XMLSerializer().serializeToString(svgEl);
    }

    showToast('Цвет применён');
  });

  // Toast notification
  function showToast(text) {
    const toast = document.getElementById('sr-toast');
    const toastText = document.getElementById('sr-toast-text');
    toastText.textContent = text;
    toast.classList.add('visible');
    setTimeout(() => toast.classList.remove('visible'), 2500);
  }

  function downloadBlob(blob, filename) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
})();
</script>
</body>
</html>